<!DOCTYPE html>
<html>

<head>
	<title>{% if title %}{{ title }} | {% endif %}CYBERCOM Admin Panel</title>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">
	<link rel="shortcut icon" href="{{ url_for('views.themes', theme='admin', path='img/favicon.ico') }}" type="image/x-icon">
	<link rel="icon" href="{{ url_for('views.themes', theme='admin', path='img/favicon.ico') }}" type="image/x-icon">
	{{ Assets.css("assets/css/main.scss", theme="admin") }}
	{{ Assets.css("assets/css/fonts.scss", theme="admin") }}
	{{ Assets.css("assets/css/admin.scss", theme="admin") }}
	{{ Assets.css("assets/css/codemirror.scss", theme="admin") }}
	<script type="text/javascript">
		var init = {
			'urlRoot': "{{ request.script_root }}",
			'csrfNonce': "{{ Session.nonce }}",
			'userMode': "{{ Configs.user_mode }}",
			'userId': {{ Session.id }},
			'userName': {{ User.name | tojson }},
			'userEmail': {{ User.email | tojson }},
			'teamId': {{ Team.id | tojson }},
			'teamName': {{ Team.name | tojson }},
			'start': {{ Configs.start | tojson }},
			'end': {{ Configs.end | tojson }}
		}
	</script>

	<!-- CYBERCOM Admin Panel Custom Styles -->
	<style>
		/* Navbar CYBERCOM Styling */
		.navbar-dark {
			background: var(--cyber-black) !important;
			border-bottom: 1px solid var(--cyber-border);
			backdrop-filter: blur(10px);
			padding: 1rem 0;
		}

		.navbar-brand {
			font-family: 'Orbitron', monospace;
			font-weight: 900;
			font-size: 1.1rem;
			color: var(--cyber-white) !important;
			text-transform: uppercase;
			letter-spacing: 0.15em;
			position: relative;
			padding-bottom: 0.3rem;
		}

		.navbar-brand::after {
			content: '';
			position: absolute;
			bottom: 0;
			left: 0;
			width: 100%;
			height: 2px;
			background: var(--cyber-blue);
			box-shadow: 0 0 10px var(--cyber-blue-glow);
		}

		.nav-link {
			font-family: 'Noto Sans JP', sans-serif;
			font-weight: 500;
			font-size: 0.9rem;
			color: var(--cyber-text-secondary) !important;
			transition: all 0.2s ease;
			position: relative;
			padding: 0.5rem 1rem !important;
		}

		.nav-link:hover,
		.nav-link.active {
			color: var(--cyber-blue) !important;
		}

		.nav-link::before {
			content: '';
			position: absolute;
			bottom: 0;
			left: 50%;
			width: 0;
			height: 2px;
			background: var(--cyber-blue);
			transform: translateX(-50%);
			transition: width 0.2s ease;
		}

		.nav-link:hover::before {
			width: 80%;
		}

		/* Dropdown menus */
		.dropdown-toggle::after {
			color: var(--cyber-blue);
		}

		/* Footer styling */
		.footer {
			background: var(--cyber-black);
			border-top: 1px solid var(--cyber-border);
			padding: 2rem 0;
			margin-top: 3rem;
		}

		.footer a {
			font-family: 'JetBrains Mono', monospace;
			color: var(--cyber-text-dim);
			font-size: 0.85rem;
			text-transform: uppercase;
			letter-spacing: 0.1em;
			transition: color 0.2s ease;
		}

		.footer a:hover {
			color: var(--cyber-blue);
		}

		.footer .text-muted {
			font-family: 'JetBrains Mono', monospace;
			font-size: 0.85rem;
		}

		/* Update notification banner */
		.bg-warning.text-center {
			background: rgba(255, 149, 0, 0.1) !important;
			border-bottom: 1px solid #ff9500;
		}

		.bg-warning .btn-warning {
			background: #ff9500 !important;
			border-color: #ff9500 !important;
			color: var(--cyber-black) !important;
			font-family: 'JetBrains Mono', monospace;
			font-weight: 600;
		}

		.bg-warning .btn-warning:hover {
			background: var(--cyber-white) !important;
			border-color: var(--cyber-white) !important;
		}
	</style>

	{% block stylesheets %} {% endblock %}
	{% for stylesheet in get_registered_admin_stylesheets() %}
		{% if stylesheet.startswith('http') %}
			<link rel="stylesheet" type="text/css" href="{{ stylesheet }}">
		{% elif request.script_root %}
			<link rel="stylesheet" type="text/css" href="{{ request.script_root }}/{{ stylesheet }}">
		{% else %}
			<link rel="stylesheet" type="text/css" href="{{ stylesheet }}">
		{% endif %}
	{% endfor %}
</head>

<body>
	<nav class="navbar navbar-expand-md navbar-dark bg-dark fixed-top">
		<div class="container">
			<a href="{{ url_for('views.static_html', route='/') }}" class="navbar-brand">CYBERCOM ADMIN</a>
			<button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#base-navbars"
					aria-controls="base-navbars" aria-expanded="false" aria-label="Toggle navigation">
				<span class="navbar-toggler-icon"></span>
			</button>
			<div class="collapse navbar-collapse" id="base-navbars">
				<ul class="navbar-nav mr-auto">
					<li class="nav-item"><a class="nav-link" href="{{ url_for('admin.statistics') }}">Statistics</a></li>
					<li class="nav-item"><a class="nav-link" href="{{ url_for('admin.notifications') }}">Notifications</a>
					</li>
					<li class="nav-item dropdown">
						<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="true">Pages</a>
						<div class="dropdown-menu">
							<a class="dropdown-item" href="{{ url_for('admin.pages_listing') }}">All Pages</a>
							<a class="dropdown-item" href="{{ url_for('admin.pages_new') }}">New Page</a>
						</div>
					</li>
					<li class="nav-item"><a class="nav-link" href="{{ url_for('admin.users_listing') }}">Users</a></li>
					{% if get_config('user_mode') == 'teams' %}
					<li class="nav-item"><a class="nav-link" href="{{ url_for('admin.teams_listing') }}">Teams</a></li>
					{% endif %}
					<li class="nav-item"><a class="nav-link" href="{{ url_for('admin.scoreboard_listing') }}">Scoreboard</a></li>
					<li class="nav-item"><a class="nav-link" href="{{ url_for('admin.challenges_listing') }}">Challenges</a></li>
					<li class="nav-item dropdown">
						<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button"
						   aria-haspopup="true" aria-expanded="true">Submissions</a>
						<div class="dropdown-menu">
							<a class="dropdown-item" href="{{ url_for('admin.submissions_listing') }}">All Submissions</a>
							<a class="dropdown-item" href="{{ url_for('admin.submissions_listing', submission_type='correct') }}">Correct Submissions</a>
							<a class="dropdown-item" href="{{ url_for('admin.submissions_listing', submission_type='incorrect') }}">Incorrect Submissions</a>
						</div>
					</li>
					<li class="nav-item"><a class="nav-link" href="{{ url_for('admin.config') }}">Config</a></li>

					{% set plugin_menu = get_admin_plugin_menu_bar() %}
					{% set plugins = get_menubar_plugins() %}
					{% if plugin_menu or plugins %}
						<li class="nav-item">
							<a class="nav-link d-none d-md-block d-lg-block" style="opacity: 0.3;">|</a>
						</li>

						{% for menu in plugin_menu %}
							{% if request.script_root %}
								{% set route = '/' + request.script_root + '/' + menu.route %}
							{% else %}
								{% set route = menu.route %}
							{% endif %}
							<li class="nav-item">
								<a class="nav-link" href="{{ route }}" {% if menu.link_target %}target="{{ menu.link_target }}"{% endif %}>
									{{ menu.title }}
								</a>
							</li>
						{% endfor %}

						{% if plugins %}
						<li class="nav-item dropdown">
							<a href="#" class="nav-link dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Plugins <span class="caret"></span></a>
							<ul class="dropdown-menu">
									{% for plugin in plugins %}
											<a class="dropdown-item" href="{{ request.script_root }}{{ plugin.route }}">{{ plugin.name }}</a>
									{% endfor %}
							</ul>
						</li>
						{% endif %}
					{% endif %}
				</ul>
				<ul class="nav navbar-nav navbar-right">
					<li class="nav-item">
						<a class="nav-link" href="https://docs.ctfd.io/" target="_blank">
							<i class="far fa-question-circle"></i>
						</a>
					</li>
				</ul>
			</div>
		</div>
	</nav>

	<main role="main">
		{% if get_config('version_latest') %}
		<div class="container-fluid bg-warning text-center py-3">
			<div class="row">
				<div class="col-md-12">
					<a class="btn btn-warning" href="{{ get_config('version_latest') }}">
						A new CTFd version is available!
					</a>
				</div>
			</div>
		</div>
		{% endif %}
		{% block content %}
		{% endblock %}
	</main>

	<footer class="footer pt-2">
		<div class="container text-center">
			<a href="https://ctfd.io" class="text-secondary">
				<small class="text-muted">
					Powered by CTFd
				</small>
			</a>
			<span>
				<small class="text-muted"><br> Version {{ get_config('ctf_version') }}</small>
			</span>
			<div style="margin-top: 1rem;">
				<small class="text-muted" style="font-family: 'Orbitron', monospace; letter-spacing: 0.1em;">CYBERCOM SECURITY GRID â€” ADMIN INTERFACE</small>
			</div>
		</div>
	</footer>

	{% block entrypoint %}
		{{ Assets.js("assets/js/pages/main.js", theme="admin") }}
	{% endblock %}

	{% block scripts %} {% endblock %}

	{% for script in get_registered_admin_scripts() %}
		{% if script.startswith('http') %}
			<script defer src="{{ script }}"></script>
		{% elif request.script_root %}
			<script defer src="{{ request.script_root }}/{{ script }}"></script>
		{% else %}
			<script defer src="{{ script }}"></script>
		{% endif %}
	{% endfor %}
</body>

</html>
